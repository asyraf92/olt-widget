function parseConfigDate(e){if(e.includes("T"))return new Date(e);let[t,i]=e.split(" "),[a,o,l]=t.split("-"),r=`${l}-${o}-${a} ${i}`;return new Date(r)}function formatDateTime(e){let t=parseConfigDate(e),i=t.toLocaleDateString(launchCONFIG.dateFormat.locale,launchCONFIG.dateFormat.dateOptions),a;if(launchCONFIG.dateFormat.customTimeFormat&&launchCONFIG.dateFormat.timeOptions.hour12){let o=t.getHours(),l=t.getMinutes(),r=l.toString().padStart(2,"0"),s;a=`${0===o?12:o>12?o-12:o}:${r} ${s=o>=1&&o<12?"PG":o>=12&&o<14?"T/HARI":o>=14&&o<19?"PTG":o>=19&&o<24?"MLM":"T/MLM"}`}else a=t.toLocaleTimeString(launchCONFIG.dateFormat.locale,launchCONFIG.dateFormat.timeOptions);return{date:i,time:a,fullDate:t}}function replacePlaceholders(e,t,i){return e.replace("{date}",t).replace("{time}",i)}function insertBeforeForm(){let e=document.getElementById("form"),t=document.getElementById("availabilityContainer"),i=document.getElementById("content");t&&e&&(e.parentNode.insertBefore(t,e),i&&(i.style.float="none"))}function setFormDisabled(e){let t=document.getElementById("order_form");if(t){if(e){t.classList.add("form-disabled");let i=t.querySelectorAll("input, select, textarea, button");i.forEach(e=>{e.disabled=!0,e.setAttribute("data-was-disabled","true")})}else{t.classList.remove("form-disabled");let a=t.querySelectorAll("input, select, textarea, button");a.forEach(e=>{"true"===e.getAttribute("data-was-disabled")&&(e.disabled=!1,e.removeAttribute("data-was-disabled"))})}}}function controlFormState(e,t=!1,i="notAvailable"){let a=document.getElementById("form"),o=document.getElementById("statusMessage");if(a){switch(setFormDisabled(!1),a.classList.remove("hidden"),o.style.display="none",o.classList.remove("not-available","expired"),e){case"hide":a.classList.add("hidden");break;case"disable":setFormDisabled(!0)}t&&launchCONFIG.formBehavior.showMessagesWhenDisabled&&(o.classList.add("notAvailable"===i?"not-available":"expired"),o.style.display="block"),launchCONFIG.debugMode&&console.log(`ðŸ”§ Form state: ${e}`,{showMessage:t,messageType:i})}}function applyStickyBehavior(){if(!launchCONFIG.stickyTimer.enabled)return;let e=document.getElementById("unifiedTimer"),t=document.body;e.classList.remove("sticky-top","sticky-bottom"),t.classList.remove("sticky-timer-top-active","sticky-timer-bottom-active");let i=new Date().getTime(),a=!1;if((a=i<availabilityTimestamp?launchCONFIG.stickyTimer.beforeAvailable:i>=availabilityTimestamp&&i<expiryTimestamp?launchCONFIG.stickyTimer.duringAvailable:launchCONFIG.stickyTimer.afterExpiry)&&!e.classList.contains("hidden")){let o="bottom"===launchCONFIG.stickyTimer.position?"sticky-bottom":"sticky-top",l="bottom"===launchCONFIG.stickyTimer.position?"sticky-timer-bottom-active":"sticky-timer-top-active";e.classList.add(o),t.classList.add(l),setTimeout(()=>{let i=e.offsetHeight,a=i+0;"bottom"===launchCONFIG.stickyTimer.position?t.style.paddingBottom=`${a}px`:t.style.paddingTop=`${a}px`,launchCONFIG.debugMode&&console.log(`Sticky applied: ${o}, Height: ${i}px, Padding: ${a}px`)},100)}else"bottom"===launchCONFIG.stickyTimer.position?t.style.paddingBottom="":t.style.paddingTop=""}function thresholdToMs(e){let{hours:t=0,minutes:i=0,seconds:a=0}=e;return 36e5*t+6e4*i+1e3*a}const availabilityTimestamp=parseConfigDate(launchCONFIG.availabilityDate).getTime(),expiryTimestamp=parseConfigDate(launchCONFIG.expiryDate).getTime(),timer=document.getElementById("unifiedTimer"),timerTitle=document.getElementById("timerTitle"),messageTitle=document.getElementById("messageTitle"),messageText=document.getElementById("messageText"),daysEl=document.getElementById("days"),hoursEl=document.getElementById("hours"),minutesEl=document.getElementById("minutes"),secondsEl=document.getElementById("seconds");let hasScrolledToForm=!1;function updateTimer(){let e=new Date().getTime();if(timer.classList.remove("warning","urgent","expired"),e<availabilityTimestamp){let t=formatDateTime(launchCONFIG.availabilityDate);timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.availabilityTitle,t.date,t.time),messageTitle.textContent=launchCONFIG.text.notAvailableTitle,messageText.textContent=launchCONFIG.text.notAvailableText,updateCountdownDisplay(availabilityTimestamp-e),controlFormState(launchCONFIG.formBehavior.beforeAvailable,"show"!==launchCONFIG.formBehavior.beforeAvailable,"notAvailable")}else if(e>=availabilityTimestamp&&e<expiryTimestamp){let i=expiryTimestamp-e,a=formatDateTime(launchCONFIG.expiryDate);timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.expiryTitle,a.date,a.time),updateCountdownDisplay(i),controlFormState("show",!1),checkWarnings(i),hasScrolledToForm||(autoScroll(),hasScrolledToForm=!0)}else timer.classList.add("expired"),timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.expiryTitle,formatDateTime(launchCONFIG.expiryDate).date,formatDateTime(launchCONFIG.expiryDate).time),messageTitle.textContent=launchCONFIG.text.expiredTitle,messageText.textContent=launchCONFIG.text.expiredText,updateCountdownDisplay(0),controlFormState(launchCONFIG.formBehavior.afterExpiry,"show"!==launchCONFIG.formBehavior.afterExpiry,"expired"),clearInterval(countdownInterval);applyStickyBehavior()}function updateCountdownDisplay(e){daysEl.textContent=String(Math.floor(e/864e5)).padStart(2,"0"),hoursEl.textContent=String(Math.floor(e%864e5/36e5)).padStart(2,"0"),minutesEl.textContent=String(Math.floor(e%36e5/6e4)).padStart(2,"0"),secondsEl.textContent=String(Math.floor(e%6e4/1e3)).padStart(2,"0")}function autoScroll(){setTimeout(()=>{let e=document.getElementById("order_form");if(e){let t=0;!function i(){t++;let a=document.querySelectorAll('img[loading="lazy"], img[data-src], .lazy'),o=e.getBoundingClientRect().top+window.pageYOffset,l=Array.from(a).filter(e=>{let t=e.getBoundingClientRect().top+window.pageYOffset;return t<o}),r=l.map(e=>e.complete?Promise.resolve():new Promise(t=>{let i=setTimeout(t,1e3);e.addEventListener("load",()=>{clearTimeout(i),t()},{once:!0})}));Promise.all(r).then(()=>{let a=e.getBoundingClientRect(),o=a.top+window.pageYOffset,l=document.querySelectorAll("header, .header, .navbar"),r=0;l.forEach(e=>{let t=window.getComputedStyle(e);"fixed"===t.position&&(r=Math.max(r,e.offsetHeight))});let s=Math.max(0,o-r-30);window.scrollTo({top:s,behavior:"smooth"}),setTimeout(()=>{let a=e.getBoundingClientRect(),l=a.top+window.pageYOffset;Math.abs(l-o)>20&&t<3&&(launchCONFIG.debugMode&&console.log(`Retrying scroll, attempt ${t+1}`),i())},1500),launchCONFIG.debugMode&&console.log(`Scrolled to order form (attempt ${t})`)})}()}},500)}function checkWarnings(e){let t=thresholdToMs(launchCONFIG.warningThresholds.lowTime),i=thresholdToMs(launchCONFIG.warningThresholds.flashTime);e<=i&&e>0?timer.classList.add("urgent"):e<=t&&e>0&&timer.classList.add("warning")}insertBeforeForm(),updateTimer();const countdownInterval=setInterval(updateTimer,1e3);launchCONFIG.debugMode&&(console.log("\uD83D\uDE80 Simplified OLT Widget initialized"),console.log("\uD83D\uDCC5 Availability:",launchCONFIG.availabilityDate),console.log("\uD83D\uDCC5 Expiry:",launchCONFIG.expiryDate));
