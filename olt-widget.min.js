const launchCONFIG={availabilityDate:"1-01-2025 00:00:00",expiryDate:"1-01-2025 00:30:00",warningThresholds:{lowTime:{hours:0,minutes:3,seconds:0},flashTime:{hours:0,minutes:1,seconds:30}},formBehavior:{beforeAvailable:"disable",afterExpiry:"hide",showMessagesWhenDisabled:!0},stickyTimer:{enabled:!0,position:"top",beforeAvailable:!1,duringAvailable:!0,afterExpiry:!1},text:{availabilityTitle:"⏰ Jualan dibuka pada\n{date} jam {time}",expiryTitle:"⏰ Jualan ditutup pada\n{date} jam {time}",notAvailableTitle:"Nantikan...",notAvailableText:"Jualan bakal dibuka tidak lama lagi.\nSila nantikan pengumuman rasmi kami di Wasap Group.",expiredTitle:"Jualan Ditutup!",expiredText:"Harap maaf, tempoh jualan telah tamat.\nSila nantikan pengumuman di masa akan datang."},dateFormat:{locale:"ms-MY",dateOptions:{weekday:"long",year:"numeric",month:"long",day:"numeric"},timeOptions:{hour:"numeric",minute:"2-digit",second:void 0,hour12:!0},customTimeFormat:!0},debugMode:!1};function parseConfigDate(e){if(e.includes("T"))return new Date(e);let[t,a]=e.split(" "),[i,l,o]=t.split("-"),n=`${o}-${l}-${i} ${a}`;return new Date(n)}function formatDateTime(e){let t=parseConfigDate(e),a=t.toLocaleDateString(launchCONFIG.dateFormat.locale,launchCONFIG.dateFormat.dateOptions),i;if(launchCONFIG.dateFormat.customTimeFormat&&launchCONFIG.dateFormat.timeOptions.hour12){let l=t.getHours(),o=t.getMinutes(),n=o.toString().padStart(2,"0"),r;i=`${0===l?12:l>12?l-12:l}:${n} ${r=l>=1&&l<12?"PG":l>=12&&l<14?"T/HARI":l>=14&&l<19?"PTG":l>=19&&l<24?"MLM":"T/MLM"}`}else i=t.toLocaleTimeString(launchCONFIG.dateFormat.locale,launchCONFIG.dateFormat.timeOptions);return{date:a,time:i,fullDate:t}}function replacePlaceholders(e,t,a){return e.replace("{date}",t).replace("{time}",a)}function insertBeforeForm(){let e=document.getElementById("form"),t=document.getElementById("availabilityContainer"),a=document.getElementById("content");t&&e&&(e.parentNode.insertBefore(t,e),a&&(a.style.float="none"))}function setFormDisabled(e){let t=document.getElementById("order_form");if(t){if(e){t.classList.add("form-disabled");let a=t.querySelectorAll("input, select, textarea, button");a.forEach(e=>{e.disabled=!0,e.setAttribute("data-was-disabled","true")})}else{t.classList.remove("form-disabled");let i=t.querySelectorAll("input, select, textarea, button");i.forEach(e=>{"true"===e.getAttribute("data-was-disabled")&&(e.disabled=!1,e.removeAttribute("data-was-disabled"))})}}}function controlFormState(e,t=!1,a="notAvailable"){let i=document.getElementById("form"),l=document.getElementById("statusMessage");if(i){switch(setFormDisabled(!1),i.classList.remove("hidden"),l.style.display="none",l.classList.remove("not-available","expired"),e){case"hide":i.classList.add("hidden");break;case"disable":setFormDisabled(!0)}t&&launchCONFIG.formBehavior.showMessagesWhenDisabled&&(l.classList.add("notAvailable"===a?"not-available":"expired"),l.style.display="block"),launchCONFIG.debugMode&&console.log(`🔧 Form state: ${e}`,{showMessage:t,messageType:a})}}function applyStickyBehavior(){if(!launchCONFIG.stickyTimer.enabled)return;let e=document.getElementById("unifiedTimer"),t=document.body;e.classList.remove("sticky-top","sticky-bottom"),t.classList.remove("sticky-timer-top-active","sticky-timer-bottom-active");let a=new Date().getTime(),i=!1;if((i=a<availabilityTimestamp?launchCONFIG.stickyTimer.beforeAvailable:a>=availabilityTimestamp&&a<expiryTimestamp?launchCONFIG.stickyTimer.duringAvailable:launchCONFIG.stickyTimer.afterExpiry)&&!e.classList.contains("hidden")){let l="bottom"===launchCONFIG.stickyTimer.position?"sticky-bottom":"sticky-top",o="bottom"===launchCONFIG.stickyTimer.position?"sticky-timer-bottom-active":"sticky-timer-top-active";e.classList.add(l),t.classList.add(o),setTimeout(()=>{let a=e.offsetHeight,i=a+0;"bottom"===launchCONFIG.stickyTimer.position?t.style.paddingBottom=`${i}px`:t.style.paddingTop=`${i}px`,launchCONFIG.debugMode&&console.log(`Sticky applied: ${l}, Height: ${a}px, Padding: ${i}px`)},100)}else"bottom"===launchCONFIG.stickyTimer.position?t.style.paddingBottom="":t.style.paddingTop=""}function thresholdToMs(e){let{hours:t=0,minutes:a=0,seconds:i=0}=e;return 36e5*t+6e4*a+1e3*i}const availabilityTimestamp=parseConfigDate(launchCONFIG.availabilityDate).getTime(),expiryTimestamp=parseConfigDate(launchCONFIG.expiryDate).getTime(),timer=document.getElementById("unifiedTimer"),timerTitle=document.getElementById("timerTitle"),messageTitle=document.getElementById("messageTitle"),messageText=document.getElementById("messageText"),daysEl=document.getElementById("days"),hoursEl=document.getElementById("hours"),minutesEl=document.getElementById("minutes"),secondsEl=document.getElementById("seconds");let hasScrolledToForm=!1;function updateTimer(){let e=new Date().getTime();if(timer.classList.remove("warning","urgent","expired"),e<availabilityTimestamp){let t=formatDateTime(launchCONFIG.availabilityDate);timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.availabilityTitle,t.date,t.time),messageTitle.textContent=launchCONFIG.text.notAvailableTitle,messageText.textContent=launchCONFIG.text.notAvailableText,updateCountdownDisplay(availabilityTimestamp-e),controlFormState(launchCONFIG.formBehavior.beforeAvailable,"show"!==launchCONFIG.formBehavior.beforeAvailable,"notAvailable")}else if(e>=availabilityTimestamp&&e<expiryTimestamp){let a=expiryTimestamp-e,i=formatDateTime(launchCONFIG.expiryDate);timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.expiryTitle,i.date,i.time),updateCountdownDisplay(a),controlFormState("show",!1),checkWarnings(a),hasScrolledToForm||(autoScroll(),hasScrolledToForm=!0)}else timer.classList.add("expired"),timerTitle.innerHTML=replacePlaceholders(launchCONFIG.text.expiryTitle,formatDateTime(launchCONFIG.expiryDate).date,formatDateTime(launchCONFIG.expiryDate).time),messageTitle.textContent=launchCONFIG.text.expiredTitle,messageText.textContent=launchCONFIG.text.expiredText,updateCountdownDisplay(0),controlFormState(launchCONFIG.formBehavior.afterExpiry,"show"!==launchCONFIG.formBehavior.afterExpiry,"expired"),clearInterval(countdownInterval);applyStickyBehavior()}function updateCountdownDisplay(e){daysEl.textContent=String(Math.floor(e/864e5)).padStart(2,"0"),hoursEl.textContent=String(Math.floor(e%864e5/36e5)).padStart(2,"0"),minutesEl.textContent=String(Math.floor(e%36e5/6e4)).padStart(2,"0"),secondsEl.textContent=String(Math.floor(e%6e4/1e3)).padStart(2,"0")}function autoScroll(){setTimeout(()=>{let e=document.getElementById("order_form");if(e){let t=0;!function a(){t++;let i=document.querySelectorAll('img[loading="lazy"], img[data-src], .lazy'),l=e.getBoundingClientRect().top+window.pageYOffset,o=Array.from(i).filter(e=>{let t=e.getBoundingClientRect().top+window.pageYOffset;return t<l}),n=o.map(e=>e.complete?Promise.resolve():new Promise(t=>{let a=setTimeout(t,1e3);e.addEventListener("load",()=>{clearTimeout(a),t()},{once:!0})}));Promise.all(n).then(()=>{let i=e.getBoundingClientRect(),l=i.top+window.pageYOffset,o=document.querySelectorAll("header, .header, .navbar"),n=0;o.forEach(e=>{let t=window.getComputedStyle(e);"fixed"===t.position&&(n=Math.max(n,e.offsetHeight))});let r=Math.max(0,l-n-30);window.scrollTo({top:r,behavior:"smooth"}),setTimeout(()=>{let i=e.getBoundingClientRect(),o=i.top+window.pageYOffset;Math.abs(o-l)>20&&t<3&&(launchCONFIG.debugMode&&console.log(`Retrying scroll, attempt ${t+1}`),a())},1500),launchCONFIG.debugMode&&console.log(`Scrolled to order form (attempt ${t})`)})}()}},500)}function checkWarnings(e){let t=thresholdToMs(launchCONFIG.warningThresholds.lowTime),a=thresholdToMs(launchCONFIG.warningThresholds.flashTime);e<=a&&e>0?timer.classList.add("urgent"):e<=t&&e>0&&timer.classList.add("warning")}insertBeforeForm(),updateTimer();const countdownInterval=setInterval(updateTimer,1e3);launchCONFIG.debugMode&&(console.log("\uD83D\uDE80 Simplified OLT Widget initialized"),console.log("\uD83D\uDCC5 Availability:",launchCONFIG.availabilityDate),console.log("\uD83D\uDCC5 Expiry:",launchCONFIG.expiryDate));
